#!/usr/bin/env cagent run
version: "2"

# =============================================================================
# Bug Investigator - OpenAI Only Version
# =============================================================================
# Uses only OpenAI models - requires OPENAI_API_KEY
#
# Usage:
#   export OPENAI_API_KEY=your_key_here
#   cagent run ./cagent-openai.yaml
# =============================================================================

models:
  gpt4o:
    provider: openai
    model: gpt-4o
    max_tokens: 8192
    
  gpt-mini:
    provider: openai
    model: gpt-4o-mini
    max_tokens: 4096

agents:
  root:
    model: gpt4o
    description: Senior debugging expert that coordinates bug investigation and fixes
    instruction: |
      You are a senior software engineer and debugging expert. Your role is to help 
      developers understand and fix bugs in their code.

      ## Your Workflow

      1. **Initial Analysis**: Examine the error - identify type, language, root cause
      2. **Research Phase**: Delegate to `researcher` for docs and solutions
      3. **Diagnosis**: Explain what went wrong and why
      4. **Fix**: Delegate to `fixer` for corrected code
      5. **Validation**: Delegate to `tester` for test cases

    sub_agents: [researcher, fixer, tester]
    
    toolsets:
      - type: filesystem
      - type: think
      - type: todo

  researcher:
    model: gpt-mini
    description: Research specialist that finds documentation and solutions
    instruction: |
      You are a research specialist. Search for solutions, documentation, 
      and similar issues. Provide concise summaries with source links.

    toolsets:
      - type: mcp
        ref: docker:duckduckgo
      - type: fetch

  fixer:
    model: gpt4o
    description: Code fix specialist that implements solutions
    instruction: |
      You are a code fix specialist. Write clean fixes with minimal changes.
      Handle edge cases and explain your changes.

    toolsets:
      - type: filesystem
      - type: think

  tester:
    model: gpt-mini
    description: QA specialist that validates fixes and suggests test cases
    instruction: |
      You are a QA specialist. Review fixes, suggest test cases, 
      and write test code in the appropriate framework.

    toolsets:
      - type: filesystem
      - type: think
